<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd">

    <changeSet id="wf-eug-1" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: wf_activities</comment>
        <createTable tableName="wf_activities" schemaName="apps" remarks="Список действий">
            <column name="code" type="varchar(20)" remarks="Код действия">
                <constraints nullable="false"/>
            </column>

            <column name="name" type="varchar(100)" remarks="Наименование действия">
                <constraints nullable="true"/>
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="wf-eug-2" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: wf_activities</comment>
        <addPrimaryKey
                columnNames="code"
                constraintName="pk_wf_activities"
                schemaName="apps"
                tableName="wf_activities"/>
    </changeSet>

    <changeSet id="wf-eug-3" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: wf_states</comment>
        <createTable tableName="wf_states" schemaName="apps" remarks="Список состояний">
            <column name="code" type="varchar(20)" remarks="Код состояния">
                <constraints nullable="false"/>
            </column>

            <column name="name" type="varchar(100)" remarks="Наименование состояний">
                <constraints nullable="true"/>
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="wf-eug-4" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: wf_states</comment>
        <addPrimaryKey
                columnNames="code"
                constraintName="pk_wf_states"
                schemaName="apps"
                tableName="wf_states"/>
    </changeSet>

    <changeSet id="wf-eug-5" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: wf_objects</comment>
        <createTable tableName="wf_objects" schemaName="apps" remarks="Список состояний">
            <column name="code" type="varchar(20)" remarks="Код объекта">
                <constraints nullable="false"/>
            </column>

            <column name="name" type="varchar(100)" remarks="Наименование объекта">
                <constraints nullable="true"/>
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="wf-eug-6" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: wf_objects</comment>
        <addPrimaryKey
                columnNames="code"
                constraintName="pk_wf_objects"
                schemaName="apps"
                tableName="wf_objects"/>
    </changeSet>


    <changeSet id="wf-eug-7" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: wf_object_states</comment>
        <createTable tableName="wf_object_states" schemaName="apps" remarks="Список возможных состояний объектов">
            <column name="object_code" type="varchar(20)" remarks="Код объекта">
                <constraints nullable="false"/>
            </column>

            <column name="state_code" type="varchar(20)" remarks="Код состояния">
                <constraints nullable="false"/>
            </column>

            <column name="is_initial" type="number" remarks="Флаг - начальное состояние">
                <constraints nullable="false"/>
            </column>

            <column name="is_final" type="number" remarks="Флаг - конечное состояние">
                <constraints nullable="false"/>
            </column>

            <column name="is_users_required" type="number" remarks="Флаг - требуется пользователь">
                <constraints nullable="false"/>
            </column>

            <column name="min_users" type="number" remarks="Минимальное количество пользователей">
                <constraints nullable="true"/>
            </column>

            <column name="max_users" type="number" remarks="Максимальное количество пользователей">
                <constraints nullable="true"/>
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="wf-eug-8" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: wf_object_states</comment>
        <addPrimaryKey
                columnNames="object_code, state_code"
                constraintName="pk_wf_object_states"
                schemaName="apps"
                tableName="wf_object_states"/>
    </changeSet>


    <changeSet id="wf-eug-9" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: wf_object_activities</comment>
        <createTable tableName="wf_object_activities" schemaName="apps" remarks="Список действий с объектами">
            <column name="object_code" type="varchar(20)" remarks="Код объекта">
                <constraints nullable="false"/>
            </column>

            <column name="activity_code" type="varchar(20)" remarks="Код действия">
                <constraints nullable="false"/>
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="wf-eug-10" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: wf_object_activities</comment>
        <addPrimaryKey
                columnNames="object_code, activity_code"
                constraintName="pk_wf_object_activities"
                schemaName="apps"
                tableName="wf_object_activities"/>
    </changeSet>


    <changeSet id="wf-eug-11" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: wf_object_state_transitions</comment>
        <createTable tableName="wf_object_state_transitions" schemaName="apps" remarks="Список возможных переходов между состояниями">
            <column name="object_code" type="varchar(20)" remarks="Код объекта">
                <constraints nullable="false"/>
            </column>

            <column name="state_code_from" type="varchar(20)" remarks="Код старого состояния">
                <constraints nullable="false"/>
            </column>

            <column name="state_code_to" type="varchar(20)" remarks="Код нового состояния">
                <constraints nullable="false"/>
            </column>

            <column name="activity_code" type="varchar(20)" remarks="Код действия">
                <constraints nullable="false"/>
            </column>

            <column name="auto_call_activity_code" type="varchar(20)" remarks="Код следующего действия">
                <constraints nullable="false"/>
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="wf-eug-12" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: wf_object_state_transitions</comment>
        <addPrimaryKey
                columnNames="object_code, state_code_from, state_code_to"
                constraintName="pk_wf_object_state_transitions"
                schemaName="apps"
                tableName="wf_object_state_transitions"/>
    </changeSet>


    <changeSet id="wf-eug-13" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: wf_object_workflows</comment>
        <createTable tableName="wf_object_workflows" schemaName="apps" remarks="Список рабочих потоков">
            <column name="id" type="number" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>

            <column name="name" type="varchar(100)" remarks="Описание рабочего потока">
                <constraints nullable="false"/>
            </column>

            <column name="object_code" type="varchar(20)" remarks="Код типа объекта">
                <constraints nullable="false"/>
            </column>

            <column name="object_id" type="number" remarks="Идентификатор объекта">
                <constraints nullable="false"/>
            </column>

            <column name="current_state_code" type="varchar(20)" remarks="Код текущего состояния потока">
                <constraints nullable="true"/>
            </column>

            <column name="last_activity_code" type="varchar(20)" remarks="Код последнего действия над потоком">
                <constraints nullable="true"/>
            </column>

            <column name="is_completed" type="number" remarks="Флаг - поток завершён">
                <constraints nullable="false"/>
            </column>

            <column name="start_date" type="date" remarks="Дата работы потока">
                <constraints nullable="false"/>
            </column>

            <column name="end_date" type="date" remarks="Дата завершения работы потока">
                <constraints nullable="true"/>
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="wf-eug-14" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: wf_object_workflows</comment>
        <addPrimaryKey
                columnNames="id"
                constraintName="pk_wf_object_workflows"
                schemaName="apps"
                tableName="wf_object_workflows"/>
    </changeSet>

    <changeSet id="wf-eug-15" logicalFilePath="path-independent" author="eugene">
        <comment>Creating sequence for table: wf_object_workflows</comment>
        <createSequence
                incrementBy="1"
                schemaName="apps"
                sequenceName="wf_object_workflows_s"
                startValue="1"/>
    </changeSet>

    <changeSet id="wf-eug-16" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: wf_object_workflow_users</comment>
        <createTable tableName="wf_object_workflow_users" schemaName="apps" remarks="Участники выполнения рабочего потока">
            <column name="id" type="number" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>

            <column name="object_workflow_id" type="number" remarks="Идентификатор рабочего потока">
                <constraints nullable="false"/>
            </column>

            <column name="user_id" type="number" remarks="Идентификатор пользователя">
                <constraints nullable="false"/>
            </column>

            <column name="state_code" type="varchar(20)" remarks="Код состояния рабочего потока">
                <constraints nullable="false"/>
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="wf-eug-17" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: wf_object_workflow_users</comment>
        <addPrimaryKey
                columnNames="id"
                constraintName="pk_wf_object_workflow_users"
                schemaName="apps"
                tableName="wf_object_workflow_users"/>
    </changeSet>

    <changeSet id="wf-eug-18" logicalFilePath="path-independent" author="eugene">
        <comment>Creating sequence for table: wf_object_workflow_users</comment>
        <createSequence
                incrementBy="1"
                schemaName="apps"
                sequenceName="wf_object_workflow_users_s"
                startValue="1"/>
    </changeSet>


    <changeSet id="wf-eug-19" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: fin_periods</comment>
        <createTable tableName="wf_object_workflow_tasks" schemaName="apps" remarks="Задачи для пользователей по выполнению рабочего потока">
            <column name="id" type="number" remarks="Идентификатор">
                <constraints nullable="false"/>
            </column>

            <column name="object_workflow_id" type="number" remarks="Идентификатор рабочего потока">
                <constraints nullable="false"/>
            </column>

            <column name="user_id" type="number" remarks="Идентификатор пользователя">
                <constraints nullable="false"/>
            </column>

            <column name="start_state_code" type="varchar(20)" remarks="Код начального состояния рабочего потока">
                <constraints nullable="false"/>
            </column>

            <column name="end_state_code" type="varchar(20)" remarks="Код конечного состояния рабочего потока">
                <constraints nullable="true"/>
            </column>

            <column name="start_date" type="TIMESTAMP" remarks="Дата и время начала выполнения задачи">
                <constraints nullable="false"/>
            </column>

            <column name="end_date" type="TIMESTAMP" remarks="Дата и время окончания выполнения задачи">
                <constraints nullable="true"/>
            </column>

            <column name="due_date" type="TIMESTAMP" remarks="Срок выполнения задачи">
                <constraints nullable="true"/>
            </column>

            <column name="is_completed" type="number" remarks="Флаг - задача завершена">
                <constraints nullable="false"/>
            </column>

            <column name="activity_code" type="varchar(20)" remarks="Код действия выбранного при завершении задачи">
                <constraints nullable="true"/>
            </column>

            <column name="user_text" type="varchar(300)" remarks="Текст пользователя при завершении задачи">
                <constraints nullable="true"/>
            </column>

            <column name="create_date" type="TIMESTAMP" remarks="Дата создания">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_date" type="TIMESTAMP" remarks="Дата изменения">
                <constraints nullable="true"/>
            </column>

            <column name="create_by" type="number" remarks="Автор">
                <constraints nullable="true"/>
            </column>

            <column name="last_update_by" type="number" remarks="Автор изменения">
                <constraints nullable="true"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet id="wf-eug-20" logicalFilePath="path-independent" author="eugene">
        <comment>Creating primary key for table: wf_object_workflow_tasks</comment>
        <addPrimaryKey
                columnNames="id"
                constraintName="pk_wf_object_workflow_tasks"
                schemaName="apps"
                tableName="wf_object_workflow_tasks"/>
    </changeSet>

    <changeSet id="wf-eug-21" logicalFilePath="path-independent" author="eugene">
        <comment>Creating sequence for table: wf_object_workflow_tasks</comment>
        <createSequence
                incrementBy="1"
                schemaName="apps"
                sequenceName="wf_object_workflow_tasks_s"
                startValue="1"/>
    </changeSet>

</databaseChangeLog>
