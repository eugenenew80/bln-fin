<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd">

    <changeSet id="fin-eug-235" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: cm_doc_keg_cte</comment>
        <addColumn schemaName="apps" tableName="cm_doc_keg_cte">
            <column name="erp_payment_code" type="varchar2(30)" defaultValue="0002" remarks="Код условий платежа в ERP-системе" >
                <constraints nullable="true"/>
            </column>

            <column name="erp_channel_code" type="varchar2(30)" defaultValue="10" remarks="Код канала сбыта в ERP-системе" >
                <constraints nullable="true"/>
            </column>

            <column name="erp_sale_depart_code" type="varchar2(30)" defaultValue="K001" remarks="Код отдела продаж во внешней системе" >
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="fin-eug-236" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: dict_gjs</comment>
        <addColumn schemaName="apps" tableName="dict_gjs">
            <column name="erp_unit_code" type="varchar2(30)" defaultValue="KWH" remarks="Код единицы измерения ОЗМ в ERP-системе" >
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="fin-eug-237" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: cm_doc_keg_cte</comment>
        <addColumn schemaName="apps" tableName="cm_doc_keg_cte">
            <column name="erp_contract_type" type="varchar2(30)" defaultValue="ZCQO" remarks="Код типа контракта в ERP-системе" >
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="fin-eug-238" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: cm_doc_keg_cte</comment>
        <addColumn schemaName="apps" tableName="cm_doc_keg_cte">
            <column name="erp_contract_num" type="varchar2(30)" remarks="Номер контракта в ERP-системе" >
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="fin-eug-239" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: cm_doc_keg_cte</comment>
        <addColumn schemaName="apps" tableName="cm_doc_keg_cte">
            <column name="transferred_to_erp_status" type="varchar2(30)" remarks="Статус передачи записи в в ERP-систему" >
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="fin-eug-240" logicalFilePath="path-independent" author="eugene">
        <comment>Creating index for table: cm_doc_keg_cte</comment>
        <createIndex schemaName="apps" tableName="cm_doc_keg_cte" indexName="idx_cm_doc_keg_cte_4">
            <column name="transferred_to_erp_status" type="varchar2(30)" />
        </createIndex>
    </changeSet>

    <changeSet id="fin-eug-241" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: cm_doc_keg_cte to media_batch_statuses</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="cm_doc_keg_cte"
                baseColumnNames="transferred_to_erp_status"
                constraintName="fk_cm_doc_keg_cte_39"
                deferrable="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="media_batch_statuses"
                referencedColumnNames="code"
        />
    </changeSet>

    <changeSet id="fin-eug-242" logicalFilePath="path-independent" author="eugene">
        <addColumn schemaName="apps" tableName="fin_invoice_rev_interface">
            <column name="invoice_id" type="number" remarks="Идентификатор счёта-фактуры" >
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="fin-eug-243" logicalFilePath="path-independent" author="eugene">
        <comment>Drop columns from table: fin_req_lines</comment>
        <dropColumn schemaName="apps" tableName="fin_req_lines" columnName="unit" />
        <dropColumn schemaName="apps" tableName="fin_req_lines" columnName="company_code" />
        <dropColumn schemaName="apps" tableName="fin_req_lines" columnName="item_num" />
    </changeSet>

    <changeSet id="fin-eug-244" logicalFilePath="path-independent" author="eugene">
        <comment>Adding columns to table: fin_req_lines</comment>
        <addColumn schemaName="apps" tableName="fin_req_lines">
            <column name="unit_id" type="number" remarks="Идентификатор единицы измерения" >
                <constraints nullable="true"/>
            </column>

            <column name="gjs_id" type="number" remarks="Идентификатор услуги" >
                <constraints nullable="true"/>
            </column>

            <column name="org_id" type="number" remarks="Идентификатор филиала" >
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="fin-eug-245" logicalFilePath="path-independent" author="eugene">
        <comment>Creating index for table: fin_req_lines</comment>
        <createIndex schemaName="apps" tableName="fin_req_lines" indexName="idx_fin_req_lines_1">
            <column name="unit_id" type="number" />
        </createIndex>
    </changeSet>

    <changeSet id="fin-eug-246" logicalFilePath="path-independent" author="eugene">
        <comment>Creating index for table: fin_req_lines</comment>
        <createIndex schemaName="apps" tableName="fin_req_lines" indexName="idx_fin_req_lines_2">
            <column name="gjs_id" type="number" />
        </createIndex>
    </changeSet>

    <changeSet id="fin-eug-247" logicalFilePath="path-independent" author="eugene">
        <comment>Creating index for table: fin_req_lines</comment>
        <createIndex schemaName="apps" tableName="fin_req_lines" indexName="idx_fin_req_lines_3">
            <column name="org_id" type="number" />
        </createIndex>
    </changeSet>

    <changeSet id="fin-eug-248" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: fin_req_lines to dict_units</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="fin_req_lines"
                baseColumnNames="unit_id"
                constraintName="fk_fin_req_lines_1"
                deferrable="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="dict_units"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="fin-eug-249" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: fin_req_lines to dict_gjs</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="fin_req_lines"
                baseColumnNames="gjs_id"
                constraintName="fk_fin_req_lines_2"
                deferrable="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="dict_gjs"
                referencedColumnNames="id"
        />
    </changeSet>

    <changeSet id="fin-eug-250" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: fin_req_lines to dict_organizations</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="fin_req_lines"
                baseColumnNames="org_id"
                constraintName="fk_fin_req_lines_3"
                deferrable="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="dict_organizations"
                referencedColumnNames="id"
        />
    </changeSet>


    <changeSet id="fin-eug-251" logicalFilePath="path-independent" author="eugene">
        <comment>Creating table: fin_sale_invoices</comment>
        <addColumn schemaName="apps" tableName="cm_doc_keg_cte">
            <column name="transferred_to_erp_status" type="varchar2(30)" remarks="Статус передачи записи в в ERP-систему" >
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="fin-eug-252" logicalFilePath="path-independent" author="eugene">
        <comment>Creating index for table: fin_sale_invoices</comment>
        <createIndex schemaName="apps" tableName="fin_sale_invoices" indexName="idx_fin_sale_invoices_4">
            <column name="transferred_to_erp_status" type="varchar2(10)" />
        </createIndex>
    </changeSet>

    <changeSet id="fin-eug-253" logicalFilePath="path-independent" author="eugene" context="dev">
        <comment>Creating foreign constraint: fin_sale_invoices to media_batch_statuses</comment>
        <addForeignKeyConstraint
                baseTableSchemaName="apps"
                baseTableName="fin_sale_invoices"
                baseColumnNames="transferred_to_erp_status"
                constraintName="fk_fin_sale_invoices_10"
                deferrable="true"
                onDelete="RESTRICT"
                onUpdate="RESTRICT"
                referencedTableSchemaName="apps"
                referencedTableName="media_batch_statuses"
                referencedColumnNames="code"
        />
    </changeSet>
</databaseChangeLog>
